---
title: "Analisis_avanzado"
output: html_document
---

# Análisis Avanzado

## Modificación del dataset

```{r}
# Leemos los datos del CSV
data <- read.csv('heart.csv')

# Creamos los datos de forma aleatoria
weigth <- sample(c(6000:15000), 918, replace = TRUE)/100
heigth <- sample(c(140:200), 918, replace = TRUE)/100
countries <- c('Spain', 'France', 'Germany', 'England', 'Portugal', 'Cuba', 'China', 'South Africa', 'Italy')
country <- sample(countries, 918, replace = TRUE)

# Los agregamos al dataframe
data$Weigth <- weigth
data$Heigth <- heigth
data$Country <- country

# Visualizamos los datos
View(data)

# Exportamos los nuevos datos a un CSV
write.csv(data,"heart3.csv", row.names = FALSE)
```

## Preprocesamiento y visualización de datos

```{r}
heart <- read.table("heart2.csv", na.strings="", header=TRUE, sep=",", dec=".")
attach(heart)
table(Cholesterol)
table(Age)
table(Sex)
table(ChestPainType)
table(RestingBP)
table(FastingBS)
table(RestingECG)
table(MaxHR)
table(ExerciseAngina)
table(Oldpeak)
table(ST_Slope)
table(HeartDisease)
table(Weigth)
table(Heigth)
table(Country)

# Preprocesamiento Age
Age -> heart$Age
boxplot(heart$Age, horizontal = TRUE)

# Preprocesamiento RestingBP
RestingBP <- heart$RestingBP
boxplot(RestingBP, horizontal = TRUE)
boxplot.stats(RestingBP)
heart_Sin_Out_RestingBP <- RestingBP[RestingBP>92 & RestingBP<170] 
boxplot(heart_Sin_Out_RestingBP, horizontal = TRUE) 
boxplot.stats(heart_Sin_Out_RestingBP)
heart1 <- filter(heart, RestingBP > 92 & RestingBP<170) 
str(heart1)
head(heart1)

# Preprocesamiento Cholesterol
Cholesterol <- heart1$Cholesterol
boxplot(Cholesterol, horizontal=TRUE)
boxplot.stats(Cholesterol)
heart1_Sin_Out_Cholesterol <- Cholesterol[Cholesterol >0 & Cholesterol < 404]
boxplot(heart1_Sin_Out_Cholesterol, horizontal=TRUE)
heart2_Sin_out_Cholesterol2 <- heart1_Sin_Out_Cholesterol[heart1_Sin_Out_Cholesterol > 110 & heart1_Sin_Out_Cholesterol< 369]
boxplot(heart2_Sin_out_Cholesterol2, horizontal=TRUE)
heart2 <- filter(heart1, Cholesterol > 110 & Cholesterol < 369)
str(heart2)
head(heart2)

# Preprocesamiento MaxHR
MaxHR <- heart2$MaxHR
boxplot(MaxHR, horizontal=TRUE)
boxplot.stats(MaxHR)
str(heart2)

# Preprocesamiento OldPeak
OldPeak <- heart2$Oldpeak
boxplot(OldPeak, horizontal=TRUE)
boxplot.stats(OldPeak)
heart2_Sin_out_OldPeak <- OldPeak[OldPeak < 3.6]
boxplot(heart2_Sin_out_OldPeak, horizontal=TRUE)
boxplot.stats(heart2_Sin_out_OldPeak)
heart3<- filter(heart2, OldPeak < 3.6)

# TODO: Preprocesamiento Weigth

# TODO: Preprocesamiento Heigth

# Dataset FINAL  sin outliers
str(heart3) 
View(heart3)

# Comprobación de outliers
boxplot(heart3$RestingBP, horizontal = TRUE)
boxplot(heart3$Cholesterol, horizontal = TRUE)
boxplot(heart3$MaxHR, horizontal = TRUE)
boxplot(heart3$Oldpeak, horizontal = TRUE)

# Resumen
summary(heart3) 

# Dataset procesado
write.csv(heart3,"heart_processed.csv", row.names = FALSE)

```

## Aplicación del análisis no supervisado

```{r}

```

## Reglas de asociación

# Referencias
# https://www.cienciadedatos.net/documentos/43_reglas_de_asociacion#Arules_package
# https://rdrr.io/cran/arules/man/discretize.html

```{r}
# Cargamos los datos
library(tidyverse)
datos <- read_csv(file = "./heart_processed.csv", col_names = TRUE)

# Añadimos una columna para el identificador de cada fila
datos <- tibble::rowid_to_column(datos, "ID")

# Discretizamos las columnas de valores continuos
datos$Age<-cut(datos$Age, c(0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80))
datos$RestingBP<-cut(datos$RestingBP, c(90,100,110,120,130,140,150,160,170,180,
                                        190,200))
datos$Cholesterol<-cut(datos$Cholesterol, c(90,100,110,120,130,140,150,160,170,
                                             180,190,200,210,220,230,240,250,260,
                                             270,280,290,300,310,320,330,340,350,
                                             360,370,380,390))
datos$MaxHR<-cut(datos$MaxHR, c(70,75,80,85,90,95,100,105,110,115,120,125,130,
                                 135,140,145,150,155,160,165,170,175,180,185,
                                 190,195,200))

# Mostramos el dataset discretizado
View(datos)

# Generamos el nuevo CSV discretizado
write.csv(datos,"heart_discretized.csv", row.names = FALSE)

# Librería arules
library(arules)

# Objeto de tipo transaction
transacciones <- read.transactions(file = "./heart_discretized.csv",
                                   format = "basket",
                                   sep = ",",
                                   header = TRUE,
                                   cols = 1,
                                   rm.duplicates = TRUE)

# Mostramos las 5 primeras transacciones
inspect(transacciones[1:5])
```





